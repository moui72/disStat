---
title: "Inter-reading timing"
author: "Tyler Peckenpaugh"
date: "April 7, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(readr)
library(psych)
library(dplyr)

raw_file <- read_csv("csvs/irt-rvad-all-48k-2019-04-03_17h03m24s.csv", 
    col_types = cols(
      Item = col_factor(levels = seq(1,48)), 
      Participant = col_character(), 
      Reading = col_factor(levels = c(
        "1", 
        "2"
))))
raw_file$Participant <- as.factor(raw_file$Participant)
irt_data <- raw_file

irt_data$cond <- paste(
  ifelse(irt_data$Condition_Q,"+Q","-Q"),
  ifelse(
    irt_data$isFiller,
    ifelse(irt_data$Condition_GP,"+PP","-PP"),
    ifelse(irt_data$Condition_GP,"+GP","-GP")
  )
)

irt_data$Q <- ifelse(
  irt_data$Condition_Q,
  "+Q",
  "-Q"
)
irt_data$GP <- ifelse(
  irt_data$Condition_GP,
  "+GP",
  "-GP"
)
irt_props_all <- describe(irt_data$irt)
utl_props <- describe(irt_data$`Utterance length`)

# exclude utterances under 1s
irt_data <- subset(irt_data, `Utterance length` > 1000)

# exclude 200 < IRTs > 25000
irt_min <- 400
irt_max <- 23000

irt_lo <- subset(irt_data, irt < irt_min)
irt_hi <- subset(irt_data, irt > irt_max)
irt_data <- subset(
  irt_data, 
  irt > irt_min & irt < irt_max
)

# winsorize top/bottom 5% of data (for normal distrbution, this is +/- 2sd)
# see: https://sciencing.com/relationship-between-standard-deviations-percentiles-8768703.html
win_trim=0.05
irt_data <- irt_data %>% group_by(Participant) %>% mutate(win_irt = winsor(irt, trim=win_trim))
# log 10 transform
irt_data$wirt.log10 <- log10(irt_data$win_irt)


meansByCondition <- 
  aggregate(
    irt_data$irt,
    by=list(
      "Q"=irt_data$Condition_Q,
      "GP"=irt_data$Condition_GP
    ),
    FUN=mean
  )
```

# Distribution of IRT

The raw IRTs are distributed as shown below.

```{r rawIRThist}
hist(irt_data$irt, breaks=80, xlab="IRT",main = "Raw IRT")
```

IRTs below `r irt_min`ms (`r nrow(irt_lo)`) and above `r round(irt_max/1000,1)`s (`r nrow(irt_hi)`) are assumed to be implausible, and are omitted.

The data have also been Winsorized to bring data in the `r win_trim*100`th and `r 100-(100*win_trim)`th percentile of data to the value at those tresholds.

```{r winsorizedIRT}
hist(
  irt_data$win_irt, 
  breaks=80, 
  xlab="IRT",
  main = "Trimmed and Winsorized IRT"
)
```

Finally the remaining data have been subjected to a common log transform to elimnate some of the skew that is common for timing data.

```{r log10winsorizedIRT}
hist(
  irt_data$wirt.log10, 
  breaks=80, xlab="IRT",
  main = "Common log of Winsorized IRT"
)
```